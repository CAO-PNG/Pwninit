#!/usr/bin/env bash
set -euo pipefail

# 解析 symlink，得到真实脚本路径
resolve_self() {
  local src="${BASH_SOURCE[0]}"
  while [[ -L "$src" ]]; do
    local dir
    dir="$(cd -P -- "$(dirname -- "$src")" && pwd -P)"
    src="$(readlink -- "$src")"
    [[ "$src" != /* ]] && src="$dir/$src"
  done
  cd -P -- "$(dirname -- "$src")" && pwd -P
}

SCRIPT_DIR="$(resolve_self)" # real .../clibc/bin
CLIBC_ROOT="$(cd -P -- "$SCRIPT_DIR/.." && pwd -P)"

# shellcheck source=/dev/null
source "$CLIBC_ROOT/lib/clibc/core.sh"

clibc_main "$@"
